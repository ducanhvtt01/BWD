<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Thông tin cá nhân | ACE SKILLS</title>
<!-- SEO Meta Tags -->
<meta name="description" content="Xem và cập nhật thông tin cá nhân của bạn trên ACE SKILLS">
<meta name="keywords" content="thông tin cá nhân, profile, ACE SKILLS, kỹ năng mềm">
<meta name="author" content="ACE SKILLS">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/css/variables.css">
<link rel="stylesheet" href="/css/reset.css">
<link rel="stylesheet" href="/css/hero.css">
<link rel="stylesheet" href="/css/section.css">
<link rel="stylesheet" href="/css/goal.css">
<link rel="stylesheet" href="/css/card.css">
<link rel="stylesheet" href="/css/button.css">
<link rel="stylesheet" href="/css/swiper.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/form.css">
<link rel="stylesheet" href="/css/responsive.css">
<link rel="stylesheet" href="/css/header.css">
<link rel="stylesheet" href="/css/wow-theme-index.css">

<link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css"/>
<link rel="stylesheet" href="https://unpkg.com/swiper@9/swiper-bundle.min.css"/>
<script defer src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script defer src="https://unpkg.com/swiper@9/swiper-bundle.min.js"></script>
<script defer src="/js/main.js"></script>

<style>
.profile-section {
    padding: 2rem 0;
}
.profile-container {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
}
.profile-sidebar {
    background: #fff;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    height: fit-content;
}
.profile-avatar-large {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin: 0 auto 1.5rem;
    display: block;
    border: 4px solid #fff;
    box-shadow: 0 0 0 4px var(--primary, #2471ff);
}
.profile-main {
    background: #fff;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.profile-main h2 {
    margin-bottom: 1.5rem;
    color: #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.edit-btn {
    background: var(--primary, #2471ff);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
}
.edit-btn:hover {
    background: #1a5cd6;
}
.info-item {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #eee;
}
.info-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}
.info-item label {
    font-weight: bold;
    color: #666;
    display: block;
    margin-bottom: 0.5rem;
}
.info-item p {
    margin: 0;
    color: #333;
}
.info-item input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}
.info-item input:focus {
    border-color: var(--primary, #2471ff);
    outline: none;
}
.save-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 1rem;
}
.save-btn:hover {
    background: #218838;
}
.cancel-btn {
    background: #6c757d;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 1rem;
    margin-left: 0.5rem;
}
.cancel-btn:hover {
    background: #5a6268;
}
.logout-btn {
    background: #ff4444;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 1rem;
    width: 100%;
}
.logout-btn:hover {
    background: #cc0000;
}
@media (max-width: 768px) {
    .profile-container {
        grid-template-columns: 1fr;
    }
    .profile-sidebar {
        text-align: center;
    }
}
</style>
</head>
<body>

<style>
body { margin-top: 72px; }
@media (max-width: 768px) { body { margin-top: 64px; } }
</style>

<header>
  <nav class="container">
    <div class="logo text-gradient">ACE SKILLS</div>
    <button class="nav-toggle" aria-label="Mở menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <div class="nav-links">
      <a href="/">Trang chủ</a>
      <a href="/skills">Kỹ năng</a>
      <a href="/courses">Khóa học</a>
      <a href="/children" data-no-transition>Trẻ em</a>
      <a href="/donate">Donate</a>
      <a href="/login" id="loginNav">Đăng nhập</a>
      <a href="/profile" id="profileNav" style="display: none;" class="profile-link">
        <span class="profile-name"></span>
        <img src="/image/default-avatar.png" alt="Avatar" class="profile-avatar">
      </a>
    </div>
  </nav>
</header>



<section class="section profile-section" data-aos="fade-up">
  <div class="container">
    <div class="profile-container">
      <div class="profile-sidebar">
        <img src="/image/default-avatar.png" alt="Avatar" class="profile-avatar-large" id="profileAvatar">
        <button class="logout-btn" onclick="logout()">Đăng xuất</button>
      </div>
      <div class="profile-main">
        <h2>
          Thông tin tài khoản
          <button class="edit-btn" onclick="toggleEdit()" id="editBtn">Chỉnh sửa</button>
        </h2>
        <form id="profileForm" onsubmit="updateProfile(event)">
          <div class="info-item">
            <label>Họ và tên:</label>
            <p id="userFullName"></p>
            <input type="text" id="fullNameInput" style="display: none;" required>
          </div>
          <div class="info-item">
            <label>Email:</label>
            <p id="userEmail"></p>
            <input type="email" id="emailInput" style="display: none;" required>
          </div>
          <div class="info-item">
            <label>Mật khẩu:</label>
            <p>••••••••</p>
            <input type="password" id="passwordInput" style="display: none;" placeholder="Để trống nếu không muốn thay đổi">
          </div>
          <div id="editButtons" style="display: none;">
            <button type="submit" class="save-btn">Lưu thay đổi</button>
            <button type="button" class="cancel-btn" onclick="cancelEdit()">Hủy</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="col">
    <h4>Liên hệ</h4>
    <a href="mailto:hello@softskill4all.org">hello@softskill4all.org</a>
    <a href="#">+84 123 456 789</a>
  </div>
  <div class="col">
    <h4>Mạng xã hội</h4>
    <a href="#">Facebook</a>
    <a href="#">YouTube</a>
  </div>
  <div class="col">
    <h4>Chương trình</h4>
    <a href="/skills">Kỹ năng</a>
    <a href="/courses">Khóa học</a>
  </div>
</footer>

<div id="toast" class="toast"></div>

<script>
// Kiểm tra đăng nhập
window.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/login';
        return;
    }
    
    // Lấy thông tin user
    const user = JSON.parse(localStorage.getItem('user'));
    if (user) {
        document.getElementById('userFullName').textContent = user.fullName;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('fullNameInput').value = user.fullName;
        document.getElementById('emailInput').value = user.email;
    }
});

// Hàm đăng xuất
function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    window.location.href = '/';
}

// Hàm chuyển đổi chế độ chỉnh sửa
function toggleEdit() {
    const editBtn = document.getElementById('editBtn');
    const editButtons = document.getElementById('editButtons');
    const fullNameInput = document.getElementById('fullNameInput');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const userFullName = document.getElementById('userFullName');
    const userEmail = document.getElementById('userEmail');

    if (editBtn.textContent === 'Chỉnh sửa') {
        // Chuyển sang chế độ chỉnh sửa
        editBtn.textContent = 'Hủy';
        editButtons.style.display = 'block';
        userFullName.style.display = 'none';
        userEmail.style.display = 'none';
        fullNameInput.style.display = 'block';
        emailInput.style.display = 'block';
        passwordInput.style.display = 'block';
    } else {
        // Hủy chỉnh sửa
        cancelEdit();
    }
}

// Hàm hủy chỉnh sửa
function cancelEdit() {
    const editBtn = document.getElementById('editBtn');
    const editButtons = document.getElementById('editButtons');
    const fullNameInput = document.getElementById('fullNameInput');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const userFullName = document.getElementById('userFullName');
    const userEmail = document.getElementById('userEmail');

    editBtn.textContent = 'Chỉnh sửa';
    editButtons.style.display = 'none';
    userFullName.style.display = 'block';
    userEmail.style.display = 'block';
    fullNameInput.style.display = 'none';
    emailInput.style.display = 'none';
    passwordInput.style.display = 'none';

    // Khôi phục giá trị cũ
    const user = JSON.parse(localStorage.getItem('user'));
    if (user) {
        fullNameInput.value = user.fullName;
        emailInput.value = user.email;
        passwordInput.value = '';
    }
}

// Hàm cập nhật thông tin
async function updateProfile(event) {
    event.preventDefault();
    
    const fullName = document.getElementById('fullNameInput').value;
    const email = document.getElementById('emailInput').value;
    const password = document.getElementById('passwordInput').value;

    try {
        const response = await fetch('/api/auth/update-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({
                fullName,
                email,
                password: password || undefined
            })
        });

        const data = await response.json();

        if (response.ok) {
            // Cập nhật localStorage
            const user = JSON.parse(localStorage.getItem('user'));
            user.fullName = fullName;
            user.email = email;
            localStorage.setItem('user', JSON.stringify(user));

            // Cập nhật UI
            document.getElementById('userFullName').textContent = fullName;
            document.getElementById('userEmail').textContent = email;
            
            // Thoát chế độ chỉnh sửa
            cancelEdit();
            
            showToast('Cập nhật thông tin thành công!');
        } else {
            showToast(data.message || 'Có lỗi xảy ra khi cập nhật thông tin');
        }
    } catch (error) {
        showToast('Có lỗi xảy ra khi cập nhật thông tin');
        console.error('Error:', error);
    }
}
</script>

<script src="/js/profile.js"></script>
<script src="/js/auth.js"></script>

</body>
</html> 